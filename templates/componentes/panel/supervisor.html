<div class="col-12 mt-2"><h5 class="text-secondary border-bottom pb-2"><i class="bi bi-bar-chart-line"></i> Supervisión y Auditoría</h5></div>

<!-- Tarjeta: Generación de Reportes (estilo Dashboard) -->
<div class="col-lg-6 col-md-12">
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-file-earmark-spreadsheet"></i> Generación de Reportes</h5>
        </div>
        <div class="card-body">
            <p class="text-muted mb-3">Visualiza reportes según las secciones del REM</p>
            <div class="list-group">
                <a href="{% url 'reportes:seccion_a' %}" class="list-group-item list-group-item-action">
                    <h6 class="mb-1">Sección A: Información General de Partos</h6>
                    <p class="mb-0 small text-muted">Estadísticas de partos, tipos y complicaciones</p>
                </a>
                <a href="{% url 'reportes:seccion_b' %}" class="list-group-item list-group-item-action">
                    <h6 class="mb-1">Sección B: Interrupción del Embarazo</h6>
                    <p class="mb-0 small text-muted">Registro de abortos y causales</p>
                </a>
                <a href="{% url 'reportes:seccion_c' %}" class="list-group-item list-group-item-action">
                    <h6 class="mb-1">Sección C: Métodos Anticonceptivos al Alta</h6>
                    <p class="mb-0 small text-muted">Cobertura de anticoncepción en el alta</p>
                </a>
                <a href="{% url 'reportes:seccion_d' %}" class="list-group-item list-group-item-action">
                    <h6 class="mb-1">Sección D: Información de Recién Nacidos</h6>
                    <p class="mb-0 small text-muted">Indicadores de recién nacidos</p>
                </a>
                <a href="#" class="list-group-item list-group-item-action" data-bs-toggle="modal" data-bs-target="#modalExportMadres">
                    <h6 class="mb-1">Exportar Madres y REM (Excel)</h6>
                    <p class="mb-0 small text-muted">Selecciona un rango de fechas para exportar madres, partos y las 4 secciones REM</p>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Modal selección de fechas - Fuera del list-group para evitar parpadeo -->
<div class="modal fade" id="modalExportMadres" tabindex="-1" aria-labelledby="modalExportMadresLabel" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalExportMadresLabel">Exportar Datos y REM</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <label for="modal_fecha_inicio" class="form-label small">Fecha Inicio</label>
                    <input id="modal_fecha_inicio" name="fecha_inicio" type="date" class="form-control form-control-sm" required />
                </div>
                <div class="mb-2">
                    <label for="modal_fecha_fin" class="form-label small">Fecha Fin</label>
                    <input id="modal_fecha_fin" name="fecha_fin" type="date" class="form-control form-control-sm" required />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancelar</button>
                <a id="btnDescargarExcel" href="#" class="btn btn-success btn-sm">
                    <i class="bi bi-file-earmark-excel"></i> Excel
                </a>
                <a id="btnDescargarPDF" href="#" class="btn btn-danger btn-sm">
                    <i class="bi bi-file-earmark-pdf"></i> PDF
                </a>
            </div>
        </div>
    </div>
</div>

<script>
(function(){
    // Calcular fechas: primer día del mes y hoy
    function toISODate(d){
        const yyyy = d.getFullYear();
        const mm = String(d.getMonth()+1).padStart(2,'0');
        const dd = String(d.getDate()).padStart(2,'0');
        return `${yyyy}-${mm}-${dd}`;
    }
    const today = new Date();
    const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);

    // Poner valores por defecto en modal inputs cuando se abre
    const modal = document.getElementById('modalExportMadres');
    modal && modal.addEventListener('show.bs.modal', function(){
        const inicio = document.getElementById('modal_fecha_inicio');
        const fin = document.getElementById('modal_fecha_fin');
        if(inicio && !inicio.value) inicio.value = toISODate(firstDay);
        if(fin && !fin.value) fin.value = toISODate(today);
    });

    // Manejar botones de descarga
    const btnExcel = document.getElementById('btnDescargarExcel');
    const btnPDF = document.getElementById('btnDescargarPDF');
    
    btnExcel && btnExcel.addEventListener('click', function(e){
        e.preventDefault();
        const inicio = document.getElementById('modal_fecha_inicio').value;
        const fin = document.getElementById('modal_fecha_fin').value;
        window.location.href = `{% url 'reportes:descargar_export_madres' %}?fecha_inicio=${inicio}&fecha_fin=${fin}`;
    });
    
    btnPDF && btnPDF.addEventListener('click', function(e){
        e.preventDefault();
        const inicio = document.getElementById('modal_fecha_inicio').value;
        const fin = document.getElementById('modal_fecha_fin').value;
        window.location.href = `{% url 'reportes:descargar_pdf_export_madres' %}?fecha_inicio=${inicio}&fecha_fin=${fin}`;
    });
})();
</script>

<!-- Right column: Métricas y Auditoría, con tamaño y estilo similares a Generación de Reportes -->
<div class="col-lg-6 col-md-12 d-flex flex-column gap-3">
    <div class="card border-0 shadow-sm">
        <div class="card-header bg-success text-white">
            <h5 class="mb-0"><i class="bi bi-graph-up"></i> Métricas Generales</h5>
        </div>
        <div class="card-body">
            <p class="text-muted mb-3">Resumen de indicadores clave del sistema</p>
            <a href="{% url 'reportes:metricas' %}" class="btn btn-success w-100">
                <i class="bi bi-graph-up"></i> Ver Métricas Completas
            </a>
        </div>
    </div>

    <div class="card border-0 shadow-sm">
        <div class="card-header bg-warning text-dark">
            <h5 class="mb-0"><i class="bi bi-shield-check"></i> Auditoría del Sistema</h5>
        </div>
        <div class="card-body">
            <p class="text-muted mb-3">Registro de inicios de sesión y cambios de datos</p>
            <a href="{% url 'reportes:auditoria' %}" class="btn btn-warning w-100">
                <i class="bi bi-shield-check"></i> Ver Auditoría
            </a>
        </div>
    </div>
</div>
